<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Last Frontier Heliskiing — AI Assistant (Internal Testing)</title>
    <meta name="robots" content="noindex, nofollow">

    <!-- Preload custom font -->
    <link rel="preload"
          href="https://yannicksegaar.github.io/lastfrontier-voiceflow-styles/fonts/NexaRustSansBlack2.woff2"
          as="font" type="font/woff2" crossorigin>

    <style>
        @font-face {
            font-family: 'Nexa Rust Sans Black 2';
            src: url('https://yannicksegaar.github.io/lastfrontier-voiceflow-styles/fonts/NexaRustSansBlack2.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background:
                linear-gradient(rgba(0, 0, 0, 0.55), rgba(0, 0, 0, 0.55)),
                url('https://yannicksegaar.github.io/RomAIx-Logo/LFH_bg_content_and_image_black.png') center/cover no-repeat fixed;
            color: #FFFFFF;
        }

        /* Internal testing banner */
        .test-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #e62b1e;
            color: #fff;
            text-align: center;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.5px;
            z-index: 9999;
        }

        .content {
            text-align: center;
            max-width: 600px;
            padding: 40px 24px;
        }

        .logo {
            width: 320px;
            max-width: 90vw;
            margin-bottom: 32px;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));
        }

        h1 {
            font-family: 'Nexa Rust Sans Black 2', system-ui, sans-serif;
            font-size: 1.5rem;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }

        .subtitle {
            color: rgba(255,255,255,0.75);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 24px;
        }

        .instructions {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 8px;
            padding: 20px 24px;
            text-align: left;
            font-size: 0.88rem;
            line-height: 1.7;
            color: rgba(255,255,255,0.85);
            backdrop-filter: blur(4px);
        }

        .instructions strong {
            color: #e62b1e;
        }

        .instructions ul {
            margin: 8px 0 0 20px;
        }

        .instructions li {
            margin-bottom: 4px;
        }

        .version {
            margin-top: 24px;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.4);
        }
    </style>
</head>
<body>

<div class="test-banner">INTERNAL TESTING ONLY — Not for public distribution</div>

<div class="content">
    <img src="https://yannicksegaar.github.io/RomAIx-Logo/LFH_Logo_FullName_White.svg"
         alt="Last Frontier Heliskiing" class="logo">

    <h1>AI Assistant — Internal Testing</h1>

    <p class="subtitle">
        Click the chat bubble in the bottom-right corner to start testing the AI assistant.
    </p>

    <div class="instructions">
        <strong>Testing guidelines:</strong>
        <ul>
            <li>Ask about tours, lodges, pricing, safety, and booking</li>
            <li>Try different conversation paths and edge cases</li>
            <li>Test the interactive components (carousels, forms, etc.)</li>
            <li>Note any incorrect answers or unexpected behavior</li>
            <li>Share feedback with the team</li>
        </ul>
    </div>

    <p class="version" id="version-info">Loading assistant...</p>
</div>

<!-- VoiceFlow Chat Widget -->
<script>
(function(d, t) {
    var v = d.createElement(t), s = d.getElementsByTagName(t)[0];
    v.onload = async function() {
        console.log("VoiceFlow widget script loaded. Importing extensions...");

        // Device detection
        var MOBILE_BREAKPOINT = 768;
        var deviceType = window.innerWidth < MOBILE_BREAKPOINT ? 'mobile' : 'desktop';

        // Language detection
        var SUPPORTED_LANGUAGES = { en: 'EN', fr: 'FR', de: 'DE', es: 'ES' };
        var browserLang = (navigator.language || navigator.userLanguage || 'en').slice(0, 2).toLowerCase();
        var userLanguage = SUPPORTED_LANGUAGES[browserLang] || 'EN';

        // Timezone & local time
        var visitorTimezone = '';
        var localHour = '';
        var dayOfWeek = '';
        try {
            visitorTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            localHour = new Date().getHours();
            dayOfWeek = new Date().toLocaleDateString('en-US', { weekday: 'long' });
        } catch (e) {}

        // Visit tracking
        var visitCount = 1;
        var isReturning = false;
        try {
            var storedCount = localStorage.getItem('lfh_visit_count');
            if (storedCount) {
                visitCount = parseInt(storedCount, 10) + 1;
                isReturning = true;
            }
            localStorage.setItem('lfh_visit_count', String(visitCount));
        } catch (e) {}

        // Session data payload
        var sessionData = {
            device_type: deviceType,
            user_language: userLanguage,
            visitor_timezone: visitorTimezone,
            local_hour: localHour,
            day_of_week: dayOfWeek,
            is_returning: isReturning,
            visit_count: visitCount,
            page_type: 'home',
            page_topic: ''
        };

        console.log('=== BROWSER CONTEXT ===');
        console.log('Device:', deviceType, '| Language:', userLanguage);
        console.log('Timezone:', visitorTimezone, '| Hour:', localHour, '| Day:', dayOfWeek);
        console.log('Returning:', isReturning, '| Visits:', visitCount);
        console.log('========================');

        try {
            var { allExtensions } = await import('./extensions.js');
            var extensions = allExtensions.filter(function(ext) { return ext && ext.name; });

            if (extensions.length === 0) throw new Error("No valid extensions found");

            console.log("Extensions loaded:", extensions.map(function(e) { return e.name; }));
            document.getElementById('version-info').textContent =
                extensions.length + ' extensions loaded — assistant ready';

            window.voiceflow.chat.load({
                verify: { projectID: '697b7ad4c3869d8704245dc7' },
                url: 'https://general-runtime.voiceflow.com',
                versionID: 'production',
                launch: {
                    event: {
                        type: 'launch',
                        payload: sessionData
                    }
                },
                assistant: {
                    stylesheet: 'https://yannicksegaar.github.io/lastfrontier-voiceflow-styles/LFH_styles.css?=v3',
                    extensions: extensions
                }
            }).then(function() {
                console.log("VoiceFlow chat loaded successfully");

                window.voiceflow.chat.proactive.clear();
                setTimeout(function() {
                    window.voiceflow.chat.proactive.push({
                        type: 'text',
                        payload: { message: 'Curious about heliskiing in Northern BC?' }
                    });
                }, 1000);
                setTimeout(function() {
                    window.voiceflow.chat.proactive.push({
                        type: 'text',
                        payload: { message: 'I can show you around!' }
                    });
                }, 3000);
                setTimeout(function() {
                    window.voiceflow.chat.open();
                }, 4000);
            });
        } catch (error) {
            console.error("Error loading extensions:", error);
            document.getElementById('version-info').textContent = 'Extensions failed — loading basic assistant';

            window.voiceflow.chat.load({
                verify: { projectID: '697b7ad4c3869d8704245dc7' },
                url: 'https://general-runtime.voiceflow.com',
                versionID: 'production',
                launch: {
                    event: {
                        type: 'launch',
                        payload: sessionData
                    }
                }
            });
        }
    };
    v.src = 'https://cdn.voiceflow.com/widget-next/bundle.mjs';
    v.type = 'text/javascript';
    s.parentNode.insertBefore(v, s);
})(document, 'script');
</script>

<!-- Shadow DOM style injection -->
<script src="https://yannicksegaar.github.io/lastfrontier-voiceflow-styles/lastfrontier-shadow-inject.js?v=3"></script>

<!-- Help tooltip injection -->
<script>
(function() {
    var attempts = 0;
    var maxAttempts = 50;
    function injectTooltip() {
        attempts++;
        var host = document.getElementById('voiceflow-chat');
        if (!host || !host.shadowRoot) {
            if (attempts < maxAttempts) setTimeout(injectTooltip, 200);
            return;
        }
        var sr = host.shadowRoot;
        if (sr.querySelector('.lf-help-tooltip')) return;
        var assistantInfo = sr.querySelector('.vfrc-assistant-info') || sr.querySelector('[class*="assistant-info"]');
        if (!assistantInfo) {
            if (attempts < maxAttempts) setTimeout(injectTooltip, 200);
            return;
        }
        var style = document.createElement('style');
        style.id = 'lf-tooltip-styles';
        style.textContent = [
            '.lf-help-tooltip{display:flex;justify-content:center;margin-top:10px;position:relative}',
            '.lf-help-circle{width:24px;height:24px;border-radius:50%;border:none;background:linear-gradient(180deg,#ee2e24,#CC3333);color:#fff;font-size:13px;font-weight:700;font-family:"Nexa Rust Sans Black 2",system-ui,sans-serif;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:0;line-height:1;transition:filter .2s,box-shadow .2s;box-shadow:0 2px 6px rgba(204,51,51,.3)}',
            '.lf-help-circle:hover{filter:brightness(1.1);box-shadow:0 3px 10px rgba(204,51,51,.45)}',
            '.lf-help-balloon{position:absolute;top:calc(100% + 10px);left:50%;transform:translateX(-50%) translateY(-4px);width:220px;background:#F5F5F5;color:#42494e;border:1px solid #ddd;border-radius:6px;padding:14px 16px;box-shadow:0 4px 12px rgba(0,0,0,.1);opacity:0;visibility:hidden;transition:opacity .2s,transform .2s,visibility .2s;pointer-events:none;font-family:system-ui,-apple-system,sans-serif;font-size:12.5px;line-height:1.6;z-index:100;text-align:left}',
            '.lf-help-balloon::before{content:"";position:absolute;top:-6px;left:50%;margin-left:-6px;width:11px;height:11px;background:#F5F5F5;border-top:1px solid #ddd;border-left:1px solid #ddd;transform:rotate(45deg)}',
            '.lf-help-tooltip:hover .lf-help-balloon{opacity:1;visibility:visible;transform:translateX(-50%) translateY(0);pointer-events:auto}',
            '.lf-help-balloon strong{display:block;margin-bottom:8px;padding-bottom:5px;border-bottom:1px solid #e0e0e0;font-family:"Nexa Rust Sans Black 2",system-ui,sans-serif;font-size:12px;color:#CC3333;letter-spacing:.3px}',
            '.lf-help-balloon ul{margin:0;padding:0 0 0 16px;list-style:none}',
            '.lf-help-balloon li{margin-bottom:4px;color:#42494e;padding-left:2px}',
            '.lf-help-balloon li::before{content:"\\2022";color:#CC3333;font-weight:700;display:inline-block;width:14px;margin-left:-14px}'
        ].join('');
        sr.appendChild(style);
        var wrap = document.createElement('div');
        wrap.className = 'lf-help-tooltip';
        wrap.innerHTML = '<button class="lf-help-circle" aria-label="Help" type="button">?</button><div class="lf-help-balloon"><strong>I can help with:</strong><ul><li>Tours &amp; pricing</li><li>Our two lodges</li><li>Safety &amp; equipment</li><li>Getting here</li><li>Booking questions</li></ul></div>';
        assistantInfo.appendChild(wrap);
    }
    if (document.readyState === 'complete') injectTooltip();
    else window.addEventListener('load', injectTooltip);
})();
</script>

<!-- Notification sound -->
<script src="https://yannicksegaar.github.io/lastfrontier-voiceflow-styles/notification-sound.js"></script>

</body>
</html>
